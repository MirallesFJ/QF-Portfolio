import streamlit as st, pandas as pd, numpy as np
from app import load_csv  # reuse loader from main app if same folder

st.title("Expected Shortfall (CVaR)")

src = st.sidebar.radio("Data", ["Sample CSV", "Upload"])
alpha = st.sidebar.select_slider("Confidence (Î±)", [0.90, 0.95, 0.99], value=0.95)

if src == "Sample CSV":
    df = load_csv("data/AAPL.csv")
else:
    up = st.sidebar.file_uploader("CSV (date, ret)", type=["csv"])
    if not up:
        st.stop()
    df = pd.read_csv(up, parse_dates=["date"]).sort_values("date")

r = df["ret"].astype(float).dropna()
var = np.quantile(-r, 1 - alpha)
es = -r[r < -var].mean()
st.metric(f"ES @ {int(alpha*100)}%", f"{es:.6f}")
